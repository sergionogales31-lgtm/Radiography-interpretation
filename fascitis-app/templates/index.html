{% extends 'base.html' %}
{% block content %}
<div class="row g-4">
  <div class="col-md-6">
    <form method="post">
      <div class="mb-3">
        <label for="model" class="form-label">Modelo</label>
        <select id="model" name="model" class="form-select">
          <option value="demo" {% if model == 'demo' %}selected{% endif %}>DEMO</option>
          <option value="lrinec" {% if model == 'lrinec' %}selected{% endif %}>LRINEC</option>
        </select>
      </div>
      <div class="mb-3 demo-field">
        <label class="form-label">PCR (mg/L)</label>
        <input type="number" step="any" min="0" class="form-control" name="pcr" value="{{ form_values.get('pcr','') }}">
      </div>
      <div class="mb-3 demo-field">
        <label class="form-label">Leucocitos (×10⁹/L)</label>
        <input type="number" step="any" min="0" class="form-control" name="wbc" value="{{ form_values.get('wbc','') }}">
      </div>
      <div class="mb-3 demo-field">
        <label class="form-label">VSG (mm/h)</label>
        <input type="number" step="any" min="0" class="form-control" name="esr" value="{{ form_values.get('esr','') }}">
      </div>
      <div class="mb-3 lrinec-field">
        <label class="form-label">CRP (mg/L)</label>
        <input type="number" step="any" min="0" class="form-control" name="crp" value="{{ form_values.get('crp','') }}">
      </div>
      <div class="mb-3 lrinec-field">
        <label class="form-label">Leucocitos (×10⁹/L)</label>
        <input type="number" step="any" min="0" class="form-control" name="wbc" value="{{ form_values.get('wbc','') }}">
      </div>
      <div class="mb-3 lrinec-field">
        <label class="form-label">Hemoglobina (g/dL)</label>
        <input type="number" step="any" min="0" class="form-control" name="hb" value="{{ form_values.get('hb','') }}">
      </div>
      <div class="mb-3 lrinec-field">
        <label class="form-label">Sodio (mmol/L)</label>
        <input type="number" step="any" min="0" class="form-control" name="na" value="{{ form_values.get('na','') }}">
      </div>
      <div class="mb-3 lrinec-field">
        <label class="form-label">Creatinina (mg/dL)</label>
        <input type="number" step="any" min="0" class="form-control" name="creat" value="{{ form_values.get('creat','') }}">
      </div>
      <div class="mb-3 lrinec-field">
        <label class="form-label">Glucosa (mg/dL)</label>
        <input type="number" step="any" min="0" class="form-control" name="glucose" value="{{ form_values.get('glucose','') }}">
      </div>
      <div class="mb-3">
        <label for="notes" class="form-label">Hallazgos clínicos</label>
        <textarea id="notes" class="form-control" name="notes" rows="3">{{ form_values.get('notes','') }}</textarea>
      </div>
      <button type="submit" class="btn btn-primary">Calcular</button>
      {% if ai_active %}
      <span class="badge bg-info ms-2">IA activa</span>
      {% else %}
      <span class="badge bg-secondary ms-2">IA opcional</span>
      {% endif %}
    </form>
  </div>
  <div class="col-md-6">
    {% if result %}
    <div class="d-flex flex-column align-items-center">
      <div class="progress-circle my-3" style="--value:{{ result.percent }}; --color:{{ result.color_hex }}">
        <div class="fs-3">{{ result.percent }}%</div>
      </div>
      <span class="badge bg-{{ result.color_class }}">{{ result.level }}</span>
      {% if model == 'lrinec' %}
      <p class="mt-2">Puntuación LRINEC: {{ lrinec_score }} ({{ lrinec_level }})</p>
      {% endif %}
      <ul class="list-unstyled mt-2">
        {% for k,v in result.inputs.items() %}
        <li><strong>{{ k }}:</strong> {{ v }}</li>
        {% endfor %}
      </ul>
    </div>
    {% else %}
    <img src="{{ url_for('static', filename='img/hero.svg') }}" class="img-fluid" alt="Decoración">
    {% endif %}
  </div>
</div>
<script>
function toggleFields(){
  const model = document.getElementById('model').value;
  document.querySelectorAll('.demo-field').forEach(el => el.style.display = model==='demo' ? 'block':'none');
  document.querySelectorAll('.lrinec-field').forEach(el => el.style.display = model==='lrinec' ? 'block':'none');
}
window.addEventListener('load', toggleFields);
document.getElementById('model').addEventListener('change', toggleFields);
</script>
{% endblock %}
